!function(){var e=function(e,t){return void 0===e||null===e?t:e},t=function(t,n,a,i){t.hasError=!1,t.delimiter=e(t.delimiter,[","]),t.data=e(t.data,[]),t.selected=e(t.selected,[]),t.allowOutsideDataSet=e(t.allowOutsideDataSet,!1),t.sameInput=e(t.sameInput,!1),t.default_input={},t.theme=e(t.theme,"default"),t.typehead=e(t.typehead,!0),t.displayField=e(t.displayField,"text"),t.placeholder=e(t.placeholder,"Enter Text with , separated"),t.max=e(t.max,void 0),t.required=e(t.required,!1),t.name=e(t.name,"tagMe"),t.active_index=-1,t.typeheadOpened=!1,t.check_data=function(e,a){return n("filter")(e,function(e,n){return e[t.displayField]==a})[0]},t.strip_delimiters=function(e){for(var n=t.delimiter.length,a=0;a<n;a++)e=e.replace(t.delimiter[a],"");return e},t.check_delimiter=function(e){for(var n=t.delimiter.length,a=0;a<n;a++)if(e.indexOf(t.delimiter[a])>-1)return!0;return!1},t.on_input_keyup=function(e){var n="";if(void 0!==t.input&&(n=t.strip_delimiters(t.input)),void 0!==t.input&&t.check_delimiter(t.input)===!0)return""!==n&&t.processor(n),0;if(13===e.keyCode&&""!==n)return t.processor(n),0;if(8===e.keyCode&&""===n.slice(0,t.getCursorPosition(e.target))){var a=t.selected.length-1;return a===t.active_index&&(t.remove(t.selected[t.active_index]),a=-1),t.moveToTag(e,a),0}return 46===e.keyCode&&""===n.slice(t.getCursorPosition(e.target),n.length)?(t.remove(t.selected[t.active_index]),0):void 0},t.on_input_keydown=function(e){var n="";if(void 0!==t.input&&(n=t.input.replace(t.delimiter,"")),37===e.keyCode&&0===t.getCursorPosition(e.target)){var a=t.active_index===-1||0===t.active_index?t.selected.length-1:t.active_index-1;return void t.moveToTag(e,a)}if(39===e.keyCode&&t.getCursorPosition(e.target)===n.length){var i=t.active_index===-1||t.active_index===t.selected.length-1?0:t.active_index+1;return t.moveToTag(e,i),0}if(40===e.keyCode&&t.typehead===!0){t.typeheadOpened=!0;var r=t.getActiveTypeHead(e),i=r===-1||r===t.data.length-1?0:r+1;return t.moveToTagTypeHead(e,i),0}if(38===e.keyCode&&t.typehead===!0)return t.typeheadOpened=!0,0},t.onblur=function(){i(function(){t.typeheadOpened=!1,t.isFocus=!1},300)},t.getCursorPosition=function(e){var t=0;if(document.selection){e.focus();var n=document.selection.createRange();n.moveStart("character",-e.value.length),t=n.text.length}else(e.selectionStart||"0"===e.selectionStart)&&(t=e.selectionStart);return t},t.update=function(e){if(t.selected.length<t.max||void 0===t.max){t.selected.push(angular.copy(e)),t.input="",t.typeheadOpened=!1,t.hasError=!1;var n={action:"added",item:e};t.onTagAdded({event:n})}else{t.hasError=!0;var a={action:"maximum",item:e};t.onTagMaximum({event:a})}},t.remove=function(e){t.selected=n("filter")(t.selected,function(t,n){return t!==e}),t.active_index=-1;var a={action:"removed",item:e};t.onTagRemoved({event:a})},t.return_value=function(e,n){return void 0===e?(t.default_input[""+t.displayField]=n,t.default_input):e},t.moveToTag=function(e,n){for(var a=angular.element(e.target.parentNode.parentNode).find("li"),i=a.length,r=0;r<i-1;r++)if(r===n)if(t.active_index!==n){t.active_index=n,angular.element(a[r]).addClass("active");var o={action:"active",item:t.selected[t.active_index]};t.onTagActive({event:o})}else t.active_index=-1,angular.element(a[r]).removeClass("active");else angular.element(a[r]).removeClass("active")},t.moveToTagTypeHead=function(e,t){for(var n=angular.element(e.target.parentNode.parentNode.parentNode.parentNode).find("ul")[1],a=angular.element(n).find("a"),i=a.length,r=0;r<i;r++)r===t?angular.element(a[r]).addClass("active"):angular.element(a[r]).removeClass("active")},t.getActiveTypeHead=function(e){for(var t=angular.element(e.target.parentNode.parentNode.parentNode.parentNode).find("ul")[1],n=angular.element(t).find("a"),a=n.length,i=0;i<a-1;i++)if(angular.element(n[i]).hasClass("active"))return i;return-1},t.processor=function(e){var n=t.check_data(t.data,e),i=t.check_data(t.selected,e);return t.allowOutsideDataSet&&t.sameInput?void t.update(t.return_value(n,e)):t.allowOutsideDataSet&&!t.sameInput?void(void 0===i?t.update(t.return_value(n,e)):t.hasError=!0):t.allowOutsideDataSet||t.sameInput?!t.allowOutsideDataSet&&t.sameInput?void(void 0!==n?t.update(n):t.hasError=!0):(t.hasError=!0,void a.error("Error, Existing before in our output , or not among data set")):void(void 0!==n&&void 0===i?t.update(n):t.hasError=!0)}};t.$inject=["$scope","$filter","$log","$timeout"];var n=function(){return{restrict:"E",require:"?^^form",scope:{type:"@",theme:"@",data:"=?",selected:"=",sameInput:"=?",allowOutsideDataSet:"=?",typehead:"=?",displayField:"@",placeholder:"@",delimiter:"=?",onTagAdded:"&",onTagRemoved:"&",onTagActive:"&",max:"=?",onTagMaximum:"&",required:"=?",name:"@"},templateUrl:function(e,t){return"angular-tag/templates/"+t.type+".html"},controller:t,link:function(t,n,a,i){var r=angular.element(n.find("input")[0]);t.form=e(i,void 0),r.bind("keyup",function(e){t.required&&0===t.selected.length&&t.form&&t.form[r.attr("name")].$setValidity("required",!1)})}}},a=function(){return{restrict:"A",link:function(e,t,n){e.$watch(n.focusMe,function(e){e===!0&&t[0].focus()})}}},i=angular.module("angular-tag",["angular-tag/templates"]);i.directive("tagMe",n).directive("focusMe",a)}(),angular.module("angular-tag/templates",[]).run(["$templateCache",function(e){e.put("angular-tag/templates/input.html",'<div id="main-tag">\n<div class="tag-container">\n <ul ng-class="[\'tag\',{focus:isFocus},theme ]" ng-click="isFocus=true" ng-keydown="direction_keys($event)">\n    <li ng-repeat="select in selected" ng-click="(moveToTag($event,$index)) "  data-drop="true" data-drag="true" ng-model="selected" jqyoui-droppable="{index: {{$index}}}" jqyoui-draggable="{index: {{$index}}, insertInline: true, direction:\'jqyouiDirection\'}" data-jqyoui-options="{revert: \'invalid\'}" data-direction="{{item.jqyouiDirection}}">\n      {{select[displayField]}}  <a href="javascript:void(0)" ng-click="remove(select)">&times;</a>\n    </li>\n<li>\n    <input name="{{name}}" ng-class="{error:hasError}" ng-model="input" ng-keyup="on_input_keyup($event)" ng-keydown="on_input_keydown($event)" ng-focus="isFocus=true" ng-blur="onblur();" focus-me="isFocus"\n         type="input" placeholder="{{placeholder}}" ng-required="required && (!selected.length || selected.length==0)" >\n</li>\n </ul>\n</div>\n\n<ul class="tag-typehead" ng-show="(isFocus && input.length && typehead && results.length) || (typehead && typeheadOpened) " >\n    <li class="animate-repeat" ng-repeat="item in data | filter:input as results">\n       <a href="javascript:void(0)" ng-click="processor(item[displayField])">{{item[displayField]}}</a>\n    </li>\n    <!--<li class="animate-repeat" ng-if="results.length == 0">\n        <strong>No results found...</strong>\n    </li>-->\n</ul>\n</div>')}]);